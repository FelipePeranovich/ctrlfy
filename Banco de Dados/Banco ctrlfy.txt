create database ctrlfy;
use ctrlfy;

/* MERBancoMarketPlace 1: */

CREATE TABLE Produto (
    id_produto varchar(255) PRIMARY KEY,
    variacao varchar(255),
    custo float(10,2),
    qtdMin int,
    cor varchar(50),
    url_imagem varchar(255),
    quantidade int(10),
    fk_fornecedor_id_fornecedor int,
    titulo varchar(255)
);

CREATE TABLE Usuario (
    id_usuario int PRIMARY KEY AUTO_INCREMENT,
    nome varchar(100),
    email varchar(100),
    senha varchar(100),
    nivel_acesso varchar(100),
    sobrenome varchar(100),
    telefone varchar(15),
    cpf varchar(14),
    id_oauth varchar(255)
);

CREATE TABLE Marketplace (
    id_marketplace int PRIMARY KEY AUTO_INCREMENT,
    nome varchar(100),
    status bool,
    acess_token varchar(110),
    refresh_token varchar(100)
);

CREATE TABLE Pedidos (
    id_pedidos int PRIMARY KEY,
    data date,
    quantidade int,
    precoUnitario float(10,2),
    taxa float(10,2),
    frete float(10,2),
    valorTotal float(10,2),
    cdg_venda varchar(100),
    status bool,
    fk_Anuncio_id_anuncio int
);

CREATE TABLE Anuncio (
    id_anuncio int PRIMARY KEY,
    preco float(10,2),
    taxaPlataforma int,
    descricao varchar(255),
    id_item varchar(100)
);

CREATE TABLE Estoque (
    id_estoque int PRIMARY KEY AUTO_INCREMENT,
    fk_Produto_id_produto varchar(255),
    fk_marketplace_id_marketplace int
);

CREATE TABLE Produto_Anuncio (
    fk_Produto_id_produto varchar(255),
    fk_Anuncio_id_anuncio int
);

CREATE TABLE Anuncio_Marketplace (
    fk_Anuncio_id_anuncio int,
    fk_Marketplace_id_marketplace int
);

CREATE TABLE Fornecedor (
    id_fornecedor int PRIMARY KEY AUTO_INCREMENT,
    nome_fornecedor varchar(100)
);
 

 
ALTER TABLE Produto ADD CONSTRAINT FK_Produto_3
    FOREIGN KEY (fk_fornecedor_id_fornecedor)
    REFERENCES Fornecedor (id_fornecedor);
 
ALTER TABLE Pedidos ADD CONSTRAINT FK_Pedidos_2
    FOREIGN KEY (fk_Anuncio_id_anuncio)
    REFERENCES Anuncio (id_anuncio)
    ON DELETE CASCADE;
 
ALTER TABLE Estoque ADD CONSTRAINT FK_Estoque_2
    FOREIGN KEY (fk_Produto_id_produto)
    REFERENCES Produto (id_produto)
    ON DELETE RESTRICT;
 
ALTER TABLE Estoque ADD CONSTRAINT FK_Estoque_3
    FOREIGN KEY (fk_marketplace_id_marketplace)
    REFERENCES Marketplace (id_marketplace);
 
ALTER TABLE Produto_Anuncio ADD CONSTRAINT FK_Produto_Anuncio_1
    FOREIGN KEY (fk_Produto_id_produto)
    REFERENCES Produto (id_produto)
    ON DELETE RESTRICT;
 
ALTER TABLE Produto_Anuncio ADD CONSTRAINT FK_Produto_Anuncio_2
    FOREIGN KEY (fk_Anuncio_id_anuncio)
    REFERENCES Anuncio (id_anuncio)
    ON DELETE RESTRICT;
 
ALTER TABLE Anuncio_Marketplace ADD CONSTRAINT FK_Anuncio_Marketplace_1
    FOREIGN KEY (fk_Anuncio_id_anuncio)
    REFERENCES Anuncio (id_anuncio)
    ON DELETE RESTRICT;
 
ALTER TABLE Anuncio_Marketplace ADD CONSTRAINT FK_Anuncio_Marketplace_2
    FOREIGN KEY (fk_Marketplace_id_marketplace)
    REFERENCES Marketplace (id_marketplace)
    ON DELETE SET NULL;